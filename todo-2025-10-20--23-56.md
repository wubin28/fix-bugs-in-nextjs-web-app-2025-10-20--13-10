# 增强型 Textarea 实现计划

## 背景
为了解决提示词长度限制缺失的问题，我们将在 MainContent.tsx 中增强 textarea 组件的功能，添加字数限制、实时计数和警告提示等功能。

## 实现目标
1. 基本限制：1000个汉字
2. 最大限制：1050个汉字（自动截断）
3. 1000-1050个汉字之间的内容显示为红色
4. 实时显示当前字数/1000
5. 字数超限时禁用"Optimize prompt"按钮

## 实现步骤

IMPLEMENTATION CHECKLIST:

1. 创建工具函数
   - 在 `utils` 目录下创建 `textUtils.ts`
   - 实现汉字计数函数 `countChineseChars`
   - 实现文本截断函数 `truncateText`
   - 添加单元测试确保函数正确性

2. 创建自定义提示词输入组件
   - 在 `components` 目录下创建 `PromptTextarea.tsx`
   - 实现基础的 textarea 组件
   - 添加字数统计显示
   - 实现超出部分文字显示为红色的效果
   - 添加截断和警告逻辑

3. 修改 MainContent 组件
   - 替换原有的文本输入为新组件
   - 更新相关的状态管理逻辑
   - 添加字数超限时的按钮禁用逻辑

4. 添加必要的类型定义
   - 在 `types` 目录下创建 `prompt.ts`
   - 定义组件 props 接口
   - 定义事件处理器类型

5. 添加国际化文本
   - 在语言文件中添加新的文本键值对
   - 确保所有提示信息支持中英文切换

## 详细文件修改计划

### 1. 创建 utils/textUtils.ts
```typescript
// 计算字符串中的汉字数量
export const countChineseChars = (text: string): number => {
  const chineseChars = text.match(/[\u4e00-\u9fa5]/g);
  return (chineseChars || []).length;
};

// 处理文本，确保不超过最大限制
export const truncateText = (text: string, limit: number): string => {
  // 实现文本截断逻辑
  return text.slice(0, limit);
};
```

### 2. 创建 components/PromptTextarea.tsx
```typescript
interface PromptTextareaProps {
  value: string;
  onChange: (value: string) => void;
  onValidChange: (isValid: boolean) => void;
  maxLength?: number;
  hardLimit?: number;
  placeholder?: string;
  className?: string;
}
```

### 3. 修改 MainContent.tsx 中的相关代码
```typescript
const [isPromptValid, setIsPromptValid] = useState(true);

// 更新优化按钮状态
const canOptimize = originalPrompt.trim().length > 0 && isPromptValid;
```

### 4. 添加 types/prompt.ts
```typescript
export interface PromptValidationResult {
  isValid: boolean;
  message?: string;
  charCount: number;
}
```

### 5. 添加国际化文本
```typescript
{
  "promptTooLong": "提示词超出长度限制",
  "charsCount": "{{current}}/{{max}}字",
  "warningMessage": "超出部分将不会被处理"
}
```

## 文件影响范围
1. `/components/MainContent.tsx`
2. `/components/PromptTextarea.tsx` (新文件)
3. `/utils/textUtils.ts` (新文件)
4. `/types/prompt.ts` (新文件)
5. `/public/locales/zh/common.json`
6. `/public/locales/en/common.json`

## 注意事项
1. 确保所有新添加的组件都有适当的错误边界处理
2. 保持现有的深色模式支持
3. 确保新添加的组件符合现有的样式系统
4. 添加适当的加载状态处理
5. 确保良好的移动端适配

## 测试计划
1. 单元测试：
   - 文本工具函数测试
   - 组件渲染测试
   - 用户交互测试

2. 集成测试：
   - 字数统计功能
   - 文本截断功能
   - 样式切换功能

3. E2E测试：
   - 完整的用户操作流程
   - 边界条件测试

## 后续优化考虑
1. 添加复制粘贴的优化处理
2. 添加输入防抖处理
3. 考虑添加撤销/重做功能
4. 可能需要添加本地存储以防止意外关闭